{
    "name": "Katuta-02-AI-Brain",
    "nodes": [
        {
            "parameters": {
                "options": {}
            },
            "id": "b1",
            "name": "Executar entrada",
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 1,
            "position": [
                200,
                300
            ]
        },
        {
            "parameters": {
                "options": {}
            },
            "id": "ct1",
            "name": "Bate-papo Antigravidade",
            "type": "@n8n/n8n-nodes-langchain.chatTrigger",
            "typeVersion": 1,
            "position": [
                200,
                100
            ]
        },
        {
            "parameters": {
                "agent": "toolsAgent",
                "options": {
                    "systemMessage": "Você é o Katutinha (masculino), atendente gente boa da Katuta's Pizzaria. \n\n### MODO DE OPERAÇÃO:\n1. **Linguagem Natural**: Ignore erros de português, gírias e abreviações (vcs, pq, pax). Foque na INTENÇÃO do cliente.\n2. **Conversor de Horas**: Entenda horários como '7h' ou '7 da noite' como 19:00h. Nosso foco é o jantar.\n3. **Simplicidade**: Resolva dúvidas de preços e reservas de forma direta. Preços: >11 anos R$ 89,90 | 5-10 anos R$ 44,95 | Pequenos/Aniversariante (com doc) Grátis.\n4. **RESERVA**: Assim que tiver NOME e QUANTIDADE (PAX), use a 'reserva_motor'. Não peça dados desnecessários.\n5. **O GERENTE (Escalonamento)**: Se o cliente insistir em reservar após as 19:00h ou tiver um problema que você não consegue resolver de forma simples, diga: 'Entendo o seu lado! Vou chamar o gerente responsável aqui agora para ele falar com você e tentar resolver essa exceção. Só um momento!'"
                }
            },
            "id": "b2",
            "name": "Agente Katutinha",
            "type": "@n8n/n8n-nodes-langchain.agent",
            "typeVersion": 1.7,
            "position": [
                608,
                304
            ]
        },
        {
            "parameters": {
                "modelName": "gemini-1.5-flash",
                "options": {
                    "temperature": 0.5
                }
            },
            "id": "b3",
            "name": "Modelo Google Gemini",
            "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
            "typeVersion": 1,
            "position": [
                500,
                550
            ],
            "credentials": {
                "googlePalmApi": {
                    "id": "NOVA_CRED_ID_PLACEHOLDER",
                    "name": "Google Gemini(PaLM) Api account"
                }
            }
        },
        {
            "parameters": {
                "sessionIdKey": "whatsapp_id"
            },
            "id": "b4",
            "name": "Memória de IA",
            "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
            "typeVersion": 1.3,
            "position": [
                650,
                550
            ]
        },
        {
            "parameters": {
                "name": "reserva_motor",
                "description": "Ferramenta para registrar reservas. Envie 'pax' (número) e 'nome_cliente' (string).",
                "jsCode": "try {\n  const response = await fetch('http://127.0.0.1:5678/webhook/reserva-motor-webhook', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ \n       pax: parseInt(arguments[0].pax) || 1, \n       nome_cliente: arguments[0].nome_cliente || \"Cliente\"\n    })\n  });\n  const data = await response.json();\n  return data.output || \"Reserva registrada com sucesso!\";\n} catch (e) {\n  return \"Erro técnico na comunicação: \" + e.message;\n}",
                "specifyInputSchema": true,
                "jsonSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"pax\": {\n      \"type\": \"number\",\n      \"description\": \"Número total de pessoas\"\n    },\n    \"nome_cliente\": {\n      \"type\": \"string\",\n      \"description\": \"Nome do cliente para a reserva\"\n    }\n  },\n  \"required\": [\"pax\", \"nome_cliente\"]\n}"
            },
            "id": "b5",
            "name": "Ferramenta de Mesas",
            "type": "@n8n/n8n-nodes-langchain.toolCode",
            "typeVersion": 1,
            "position": [
                800,
                550
            ]
        }
    ],
    "connections": {
        "Executar entrada": {
            "main": [
                [
                    {
                        "node": "Agente Katutinha",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Bate-papo Antigravidade": {
            "main": [
                [
                    {
                        "node": "Agente Katutinha",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Modelo Google Gemini": {
            "ai_languageModel": [
                [
                    {
                        "node": "Agente Katutinha",
                        "type": "ai_languageModel",
                        "index": 0
                    }
                ]
            ]
        },
        "Memória de IA": {
            "ai_memory": [
                [
                    {
                        "node": "Agente Katutinha",
                        "type": "ai_memory",
                        "index": 0
                    }
                ]
            ]
        },
        "Ferramenta de Mesas": {
            "ai_tool": [
                [
                    {
                        "node": "Agente Katutinha",
                        "type": "ai_tool",
                        "index": 0
                    }
                ]
            ]
        }
    },
    "settings": {
        "errorWorkflow": "NyQKhHnymOvXQRdx"
    }
}